<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verification - Ceramico</title>
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/auth.css">
</head>

<body class="login-body">

    <div class="container-fluid p-0">
        <div class="row g-0 h-100vh">
            <!-- Left Side: Artistic Background -->
            <div class="col-lg-6 d-none d-lg-flex align-items-center justify-content-center position-relative login-bg">
                <div class="login-overlay"></div>
                <div class="login-content text-white text-center position-relative z-1 p-5">
                    <h1 class="display-4 fw-bold mb-3">Secure Access</h1>
                    <p class="lead">Protecting your account is our priority. Enter the code sent to your email to
                        continue.</p>
                </div>
            </div>

            <!-- Right Side: Form -->
            <div class="col-lg-6 d-flex align-items-center justify-content-center bg-white">
                <div class="auth-card-wrapper w-100">
                    <div class="auth-header text-start mb-5">
                        <h2 class="fw-bold mb-2">Verify Your Email</h2>
                        <p class="text-secondary">We've sent a 4-digit code to your email address.</p>
                    </div>

                    <form action="login.html">
                        <div class="otp-input-wrapper">
                            <input type="text" class="form-control otp-input" maxlength="1" required>
                            <input type="text" class="form-control otp-input" maxlength="1" required>
                            <input type="text" class="form-control otp-input" maxlength="1" required>
                            <input type="text" class="form-control otp-input" maxlength="1" required>
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg w-100 mb-4">Verify Account</button>

                        <div class="text-center">
                            <p class="text-secondary mb-0">Didn't receive the code?</p>
                            <a href="#" class="signup-link">Resend Verification Code</a>
                        </div>
                    </form>

                    <div class="text-center mt-5">
                        <a href="login.html"
                            class="text-decoration-none text-secondary d-flex align-items-center justify-content-center gap-2">
                            <i class="bi bi-arrow-left"></i> Back to Login
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Removed as per other auth pages layout consistency, but if needed it can be added. LOGIN.HTML doesn't have it. -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // 1. Get the email we saved during signup
    const userEmail = localStorage.getItem("verificationEmail");
    
    // Optional: Redirect back to signup if there's no email found
    if (!userEmail) {
        window.location.href = "signup.html";
    }

    const verifyForm = document.querySelector('form');
    const otpInputs = document.querySelectorAll('.otp-input');

    // Auto-focus logic for the 4 boxes
    otpInputs.forEach((input, index) => {
        input.addEventListener('input', (e) => {
            if (e.target.value.length === 1 && index < otpInputs.length - 1) {
                otpInputs[index + 1].focus();
            }
        });
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && e.target.value.length === 0 && index > 0) {
                otpInputs[index - 1].focus();
            }
        });
    });

    // 2. Handle form submission
    verifyForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        // Combine the 4 input boxes into one string
        let otpCode = "";
        otpInputs.forEach(input => {
            otpCode += input.value;
        });

        if (otpCode.length !== 4) {
            alert("Please enter all 4 digits.");
            return;
        }

        try {
            // Send email and OTP to backend
            const response = await fetch("http://localhost:5000/api/auth/verify-otp", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ 
                    email: userEmail, 
                    otp: otpCode 
                })
            });

            const data = await response.json();

            if (response.ok) {
                alert("Email verified successfully!");
                // Clear the email from storage for security
                localStorage.removeItem("verificationEmail"); 
                // âœ… Redirect to Login
                window.location.href = "login.html"; 
            } else {
                alert(data.message || "Invalid or expired OTP");
            }
        } catch (error) {
            console.error(error);
            alert("Server error. Please try again later.");
        }
    });
</script>
</body>


</html>